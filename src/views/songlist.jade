extends app
block append headpage
    title Ongaku music
block append library
    include library
block append songlist
    section.song-list
        .list-container
            .infos
                .saved-playlist
                    span.title Playlist:
                    if !session.user.isAnonymous
                      if data.playlistname
                        input.form-control(type="text", value="#{data.playlistname}", disabled)
                      else
                        input.form-control(type="text", value="Unsaved Playlist", disabled)
                      input.form-control.default#save-current-playlist(type="button", value="Save", disabled)
                      input.form-control.default(type="button", value="Create", disabled)
                    else
                      span.title Anonymous users can't save playlists.
                if !session.user.isAnonymous
                  .playlists
                      .form-group.form-group-sm
                        label.col-md-8.control-label(style="display: inline-block; vertical-align: middle; line-height: 39px;") Saved Playlists:
                        .col-md-2
                          button.btn.btn-default.dropdown-toggle(style="height:39px; display: inline-block;", type="button", data-toggle="dropdown" aria-expanded="false") Playlists
                              span.caret(style="margin-left: 5px;")
                          ul.dropdown-menu(role="menu", style="margin-left: 15px;")
                              li.playlists-elements
            .list-actions
                span.button
                    i.fa.fa-heart
                span.button
                    i.fa.fa-plus
                span.button
                    i.fa.fa-eraser
            .playlist-columns
                .tracks-columns
                    .track-info.track-px
                        .track-info.track-num
                            span Track
                        .track-info.track-time
                            span Duration
                    .track-info.track
                        .track-info.track-title
                            span Title
                        .track-info.track-artist
                            span Artist
            .songs-container.scroll-pane
                // TODO retrieve this list from server side
                ul.playlist
                    - var trackNum = 0
                    for track in data.playlist
                        li
                            a.song(data-uid="#{track.uid}", data-track="#{++trackNum}")
                                .track-info.track-px
                                    .track-info.track-num
                                        span= trackNum
                                    .track-info.track-time
                                        span= track.duration
                                .track-info.track
                                    .track-info.track-title
                                        span= track.title
                                    .track-info.track-artist
                                        span= track.artist
                .song
block append scripts
  script.
    $(function(){
      $.ongaku.library.bind();
      $.ongaku.library.fetch();
    });
  if !session.user.isAnonymous
    script.
      $(function(){
        $.get("/api/user/playlists", function(output){
          $.each(output, function(index, playlist){
            var playlistBlock = $("<a>");
            playlistBlock.text(playlist);
            $(".playlists-elements").append(playlistBlock);
          });
        });

        $("#save-current-playlist").click(function(){
          console.log("save");
          $.post("/api/user/playlist/save", function(){
              $("#save-current-playlist").prop('disabled', true);
          });
        });
      });
